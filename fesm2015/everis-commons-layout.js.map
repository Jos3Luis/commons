{"version":3,"file":"everis-commons-layout.js.map","sources":["ng://everiscommons/layout/lib/layout.interface.ts","ng://everiscommons/layout/lib/models/encrypt.model.ts","ng://everiscommons/layout/lib/models/layout.model.ts","ng://everiscommons/layout/lib/models/company-layout.model.ts","ng://everiscommons/layout/lib/models/menu-layout.model.ts","ng://everiscommons/layout/lib/layout-controller.ts","ng://everiscommons/layout/lib/layout.directive.ts","ng://everiscommons/layout/lib/layout.componet.ts","ng://everiscommons/layout/lib/sing-out.provider.ts","ng://everiscommons/layout/lib/layout-manager.module.ts"],"sourcesContent":["import { Provider, InjectionToken, Type } from '@angular/core';\n\nexport interface IMenuLayout {\n  name: string;\n  path: string;\n  icon?: string;\n  image?: string;\n  active?: boolean;\n  [key: string]: string | boolean | undefined;\n}\n\nexport interface ICompanyLayout {\n  logo?: string | undefined;\n  name?: string | undefined;\n  [key: string]: string | undefined;\n\n}\n\nexport interface ILayoutConfig {\n  menu?: IMenuLayout[] | undefined;\n  company?: ICompanyLayout | undefined;\n  showDocMenu?: boolean | undefined;\n  singOutAction?: Provider | undefined;\n  layouts: ILayoutsComponent[];\n  [key: string]: Array<IMenuLayout> | ICompanyLayout | boolean | undefined | Provider | object| ILayoutsComponent[];\n}\nexport interface ILayoutsComponent {\n  name: string;\n  // tslint:disable-next-line:no-any\n  component: Type<any>;\n  default: boolean;\n}\n\nexport const ConfigLayout = new InjectionToken<ILayoutConfig>('container');\n","\nexport class LayoutEncrypt {\n  static encryptStorage(value: string) {\n    return btoa(value).split('').reverse().join('');\n  }\n\n  static unencryptStorage(value: string) {\n    return atob(value.split('').reverse().join(''));\n  }\n}\n","import { Subject } from 'rxjs';\nimport { CoreBrowserStorage } from 'everiscore';\nimport { Observable } from 'rxjs/Observable';\nimport { ILayoutsComponent } from '../layout.interface';\nimport { LayoutEncrypt } from './encrypt.model';\n\nexport class Layout {\n  private state = new Subject<ILayoutsComponent>();\n  private $state = this.state.asObservable();\n  constructor(\n    private layouts: ILayoutsComponent[],\n    private sessionStorage: CoreBrowserStorage,\n  ) { }\n\n  getActive() {\n    const persistLayout = this.sessionStorage.get('layout') || null;\n    let ly;\n    if (persistLayout === null) {\n      ly = this.layouts.filter(layout => layout.default === true);\n    } else {\n      ly = this.layouts.filter((layout) => {\n\n        return layout.name.toString().toLowerCase() === LayoutEncrypt.unencryptStorage(persistLayout).toString().toLowerCase();\n      });\n    }\n\n    return ly.length > 0 ? ly[0] : false;\n  }\n\n  getItems(): ILayoutsComponent[] {\n    return this.layouts;\n  }\n\n  watch(): Observable<ILayoutsComponent> {\n    return this.$state;\n  }\n\n  changeLayout(name: string) {\n    const ly = this.layouts.filter(layout => layout.name.toLowerCase() === name.toLowerCase());\n    if (ly.length > 0) {\n      this.sessionStorage.set('layout', LayoutEncrypt.encryptStorage(ly[0].name));\n      this.state.next(ly[0]);\n    } else {\n      throw (\n        new Error(`El layout ${name}, no existe`)\n      );\n    }\n  }\n}\n","import { ICompanyLayout } from '../layout.interface';\n\nexport class CompanyLayout {\n  name: string | null;\n  logo: string | null;\n  constructor(private header: ICompanyLayout) {\n    this.name = this.header.name || null;\n    this.logo = this.header.logo || null;\n  }\n}\n","import { IMenuLayout } from '../layout.interface';\nimport { CoreBrowserStorage } from 'everiscore';\n\nexport class MenuLayout {\n  constructor(\n    private menu: IMenuLayout[],\n    private sessionStorage: CoreBrowserStorage,\n  ) { }\n\n  addItems(items: IMenuLayout[]) {\n    this.menu = [...this.menu, ...items];\n    this.sessionStorage.set('menu', this.menu);\n  }\n\n  get items(): IMenuLayout[] {\n    const persistMenu = this.sessionStorage.get('menu') || null;\n    if (persistMenu) {\n      this.menu = this.sessionStorage.get('menu') || '';\n    }\n     return this.menu;\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { ConfigLayout, ILayoutConfig } from './layout.interface';\nimport { CoreBrowserStorage } from 'everiscore';\nimport { Layout } from './models/layout.model';\nimport { CompanyLayout } from './models/company-layout.model';\nimport { MenuLayout } from './models/menu-layout.model';\n\n@Injectable()\nexport class LayoutController {\n  private _company: CompanyLayout;\n  private _menu: MenuLayout;\n  private _layout: Layout;\n\n  constructor (\n    @Inject(ConfigLayout) public config: ILayoutConfig,\n    private sessionStorage: CoreBrowserStorage,\n  ) {\n    this._company = new CompanyLayout(this.config.company  || {});\n    this._menu = new MenuLayout((this.config.menu || []), this.sessionStorage);\n    this._layout = new Layout(this.config.layouts, this.sessionStorage);\n  }\n\n  get company (): CompanyLayout {\n    return this._company;\n  }\n\n  get menu (): MenuLayout {\n    return this._menu;\n  }\n  get layout (): Layout {\n    return this._layout;\n  }\n}\n","import { Directive, ViewContainerRef } from '@angular/core';\n\n@Directive({\n    // tslint:disable-next-line:directive-selector\n    selector: '[eve-layout-ad-host]',\n})\nexport class EvAdLAyoutDirective {\n  constructor (public viewContainerRef: ViewContainerRef) { }\n}\n","import {\n    Component,\n    ComponentFactoryResolver,\n    ChangeDetectorRef,\n    ViewChild,\n    AfterViewInit,\n    OnInit,\n} from '@angular/core';\nimport { LayoutController } from './layout-controller';\nimport { EvAdLAyoutDirective } from './layout.directive';\n\n@Component({\n  selector: 'eve-layout',\n  template: `\n    <ng-template eve-layout-ad-host></ng-template>\n  `,\n})\nexport class EveLayoutComponent implements AfterViewInit, OnInit {\n\n  @ViewChild(EvAdLAyoutDirective)\n    adHost!: EvAdLAyoutDirective;\n\n  constructor (\n    private componentFactoryResolver: ComponentFactoryResolver,\n    private cdr: ChangeDetectorRef,\n    private lyCtrl: LayoutController,\n  ) { }\n\n  ngAfterViewInit () {\n    this.loadComponent();\n    this.cdr.detectChanges();\n  }\n  ngOnInit () {\n    this.lyCtrl.layout.watch().subscribe(() => { this.loadComponent(); });\n  }\n  loadComponent () {\n    const layout = this.lyCtrl.layout.getActive();\n    if (layout !== false) {\n      const componentFactory = this.componentFactoryResolver.resolveComponentFactory(layout.component);\n\n      const viewContainerRef = this.adHost.viewContainerRef;\n      viewContainerRef.clear();\n\n      viewContainerRef.createComponent(componentFactory);\n    } else {\n      throw (\n        new Error('No se encontro layouts para cargar por defecto, \\n revise la configuracion en su modulo principal')\n      );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nexport interface ISingOut {\n  singOut: () => void;\n}\n@Injectable()\nexport class SingOut implements ISingOut {\n  singOut () {\n    throw(\n      new Error('Debe proveer un objeto SingOut en la configuracion de Layout')\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders, ANALYZE_FOR_ENTRY_COMPONENTS } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ILayoutConfig, ConfigLayout } from './layout.interface';\nimport { IStorage, storage } from 'everiscore';\nimport { EveLayoutComponent } from './layout.componet';\nimport { EvAdLAyoutDirective } from './layout.directive';\nimport { LayoutController } from './layout-controller';\nimport { providerDef } from '@angular/core/src/view';\nimport { SingOut } from './sing-out.provider';\n\nexport { LayoutController } from './layout-controller';\nexport { CompanyLayout } from './models/company-layout.model';\nexport { MenuLayout } from './models/menu-layout.model';\nexport { Layout } from './models/layout.model';\nexport { ILayoutConfig, ICompanyLayout, IMenuLayout } from './layout.interface';\n\nexport function _sessionStorage(): IStorage<string, string> {\n  return storage('session');\n}\n\nexport function _buildLayoutCtrl(config: ILayoutConfig) {\n    return new LayoutController(config, _sessionStorage());\n}\n\nexport function _buildProviderSingOut(config: ILayoutConfig) {\n  console.log(config.singOutAction && config.singOutAction !== null, config.singOutAction);\n  return config.singOutAction && config.singOutAction !== null ? config.singOutAction : {};\n}\n\nconst COMPONENTS = [\n  EveLayoutComponent,\n  EvAdLAyoutDirective,\n];\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: [...COMPONENTS],\n  exports: [...COMPONENTS],\n})\nexport class EveLayouManager {\n  static forRoot (config: ILayoutConfig): ModuleWithProviders {\n    return {\n      ngModule: EveLayouManager,\n      providers: [\n        { provide: ConfigLayout,\n          useValue: config\n        },\n        {\n          provide: SingOut,\n          useClass: config.singOutAction || SingOut,\n        },\n        { provide: LayoutController,\n          useFactory: _buildLayoutCtrl, deps: [ConfigLayout]},\n        {\n          multi: true,\n          provide: ANALYZE_FOR_ENTRY_COMPONENTS,\n          useValue: config.layouts,\n        }\n      ]\n    };\n  }\n}\n"],"names":[],"mappings":"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"}
